{
  "rules": [
    "# ものぎめフレームワーク変換ルールブック v3.0\n\n## ゴール逆引き型 ／ テキスト出力最適化版\n\n---\n\n## 1. 基本方針\n\n- ゴール（最終成果物）から逆方向に「何が決まっている必要があるか」を遡る\n- 1ノード ＝ 1つの決定項目（「〜を決める」に言い換えられるもの）\n- エッジ ＝ 「Bを決めるにはAが決まっている必要がある」（A → B）\n- 全ノードはいずれかのゴールへの到達パス上に存在すること\n- **出力形式はテキスト（Markdown）を前提とする**\n\n---\n\n## 2. ゴールの定義と展開順序\n\n### 2-1. ゴール一覧\n\n| ID | ゴール | 定義 |\n|----|--------|------|\n| G1 | 確認申請 | 確認済証の取得に必要な全図書が揃った状態 |\n| G2 | 杭・基礎 発注/着工 | 杭業者・基礎施工者が着手できる情報が全て確定した状態 |\n| G3 | 鉄骨発注 | 鉄骨ファブが製作図を作成できる情報が全て確定した状態 |\n| G4 | 外装材発注 | 外装メーカーが製作・納品できる情報が全て確定した状態 |\n| G5 | 外構工事着工 | 外構施工者が着手できる情報が全て確定した状態 |\n| G6 | 竣工・引渡し | 全工事完了・検査合格・引渡し |\n\n### 2-2. 展開順序\n\n```\nG3（鉄骨）→ G2（杭・基礎）→ G1（確認申請）→ G4（外装材）→ G5（外構）→ G6（竣工）\n```\n\nG3が最長リードタイムかつ最多決定項目。G3を先に展開し、\n後続ゴールでは既出ノードを参照のみとし重複を排除する。\n\n---\n\n## 3. ツリー構造：3つの問いと深さ制限\n\n### 3-1. 再帰展開の3つの問い\n\n```\n問い1: このゴールを達成するには、何が決まっている必要があるか？\n問い2: その決定をするには、何が先に決まっている必要があるか？（再帰）\n問い3: これ以上遡れない項目は何か？ → 根に到達 → 再帰終了\n```\n\n### 3-2. 深さ制限（v2.0からの変更点）\n\n| 階層 | 名称 | 定義 | 目安数 |\n|------|------|------|--------|\n| Level 0 | ゴール（G） | 最終成果物 | 1〜6 |\n| Level 1 | 大決定 | G達成に直接必要な決定 | 3〜6 per G |\n| Level 2 | 中決定 | L1を決めるための先決条件 | 2〜5 per L1 |\n| Level 3 | 小決定 or 根（R） | L2の先決条件、または根 | 1〜4 per L2 |\n\n- **最大深さ：Level 3（根到達を含む）**\n- Level 3でまだ根に到達しない場合 → 粒度が細かすぎるため、Level 2を統合する方向で調整\n- ただし特殊な依存チェーン（例：クレーン仕様→建物高さ→構造計算）で4段必要な場合のみ例外的にLevel 4を許容\n\n---\n\n## 4. ノード化ルール\n\n### 4-1. ノードにする条件（全て満たすこと）\n\n| # | 条件 | チェック |\n|---|------|---------|\n| ① | いずれかのゴールへの到達パス上にある | そのノードが無いとゴール達成不可か？ |\n| ② | 決定行為である | 「〜を決める」に言い換え可能か？ |\n| ③ | 固有の判断を伴う | 他の決定から自動導出されない独立判断か？ |\n\n### 4-2. ノードにしないもの → メタデータ化\n\n| 除外対象 | 理由 | 扱い |\n|---------|------|------|\n| 選択肢の列挙（S造/RC造等） | 情報であり決定でない | 親ノードのメタデータ |\n| 調査手段（ボーリング等） | プロセスであり決定でない | 親ノードのメタデータ |\n| 自動導出値（積雪荷重等） | 判断を伴わない | 親ノードのメタデータ |\n| PM/CM管理行動 | 運用であり設計決定でない | 別表で管理 |\n\n### 4-3. 粒度調整\n\n**統合する場合：**\n- 同一パス上 + 同一先決条件 + 常に同時に決まる → 1ノードに統合\n- 親子関係が明確で子が内訳 → 親のみノード化\n\n**分割を維持する場合：**\n- 先決条件が異なる\n- 異なるゴールに異なるパスで影響\n- 異なる担当が判断\n\n### 4-4. ノードラベルの書式\n\n```\n[ID] 決定項目名\n```\n\n- 名詞句で統一、**最大15文字**\n- 「の決定」「の確定」「の選定」は省略可\n- 括弧内の選択肢列挙は含めない\n\n---\n\n## 5. エッジ（依存関係）ルール\n\n### 5-1. 方向\n\n```\nA → B ＝「Aが決まっている必要がある → Bを決められる」\n根(R) → → → ゴール(G) の方向に流れる\n```\n\n### 5-2. 種別\n\n| 種別 | 意味 | テキスト表記 |\n|------|------|-------------|\n| 先決（必須） | Aなしにはbが決まらない | `→` |\n| 相互依存 | AとBが互いに制約 | `⇔`（相互依存テーブルに記載） |\n| 参考接点 | 管理外領域との接点 | `-->`（破線相当） |\n\n### 5-3. 間引きルール\n\n- **推移的省略**：A→B→C が存在する場合、A→C は描かない\n- **例外**：相互依存エッジは間接でも残す\n- **重複排除**：同一ペアの同一方向は1本のみ\n\n---\n\n## 6. テキスト出力形式（v3.0新規）\n\n### 6-1. 出力構成（4パート）\n\nテキスト出力は以下の4パートで構成する。\n**パート間に情報の重複を作らない。**\n\n```\nPart A: ノード一覧テーブル（全ノードの定義＋メタデータ）\nPart B: エッジ一覧テーブル（全依存関係）\nPart C: ツリー図（テキストASCII）\nPart D: 相互依存テーブル（双方向関係のみ抜粋）\n```\n\n### 6-2. Part A — ノード一覧テーブル\n\n全ノードを1行1ノードでフラットに列挙する。\nメタデータ（選択肢・判断基準等）はこのテーブルの列に格納。\n\n```markdown\n| ID | ノード名 | 種別 | 担当 | メタデータ（選択肢・判断基準等） |\n|----|---------|------|------|-------------------------------|\n| G3 | 鉄骨発注 | ゴール | — | — |\n| M01 | 構造図完了 | 中間 | 構造 | — |\n| M02 | 架構計画 | 中間 | 構造 | ラーメン/ブレース/併用、経済スパン検討 |\n| R01 | 生産レイアウト | 根 | 発注者 | 工程フロー、設備配置、動線、搬入出 |\n| ... | ... | ... | ... | ... |\n```\n\n**種別：** ゴール / 中間 / 根 / 接点\n**担当：** 発注者 / 意匠 / 構造 / 設備 / 外構 / 調査・行政 / クレーンメーカー\n\n### 6-3. Part B — エッジ一覧テーブル\n\n全依存関係を1行1エッジでフラットに列挙する。\n\n```markdown\n| From | To | 種別 | 備考 |\n|------|----|------|------|\n| R01 | M02 | 先決 | レイアウト→架構計画 |\n| M02 | M01 | 先決 | 架構計画→構造図 |\n| M01 | G3 | 先決 | 構造図→鉄骨発注 |\n| ... | ... | ... | ... |\n```\n\n### 6-4. Part C — ツリー図\n\n**テキストASCIIで左（根）→ 右（ゴール）の流れを表現する。**\n\nルール：\n- 根を左端、ゴールを右端に配置\n- 中間ノードは依存の深さ順に左→右へ並べる\n- 合流（複数ノードから1ノードへ）は `─┐` `─┤` `─┘` で表現\n- 分岐（1ノードから複数ノードへ）は `├─` `│` `└─` で表現\n- **各ノードは `[ID]` のみ記載**（ノード名はPart Aを参照）\n- **相互依存はツリー図には描かない**（Part Dで別途管理）\n\n```\n[R01] ───→ [M02] ───→ [M01] ─┐\n[R02] ───→ [M03] ─┐           ├→ [G3]\n[R03] ─────────→ ─┤           │\n                    └→ [M04] ─┘\n```\n\n**ツリー図で表現しきれない合流・分岐が3本以上になる場合：**\n- ツリー図は主要パス（クリティカルパス）のみ描画\n- 残りのエッジはPart Bテーブルで補完\n\n### 6-5. Part D — 相互依存テーブル\n\n双方向の制約関係のみ抜粋。ツリー図では表現できないため別表とする。\n\n```markdown\n| 節 | ノードA | ノードB | 相互依存の内容 |\n|----|--------|--------|---------------|\n| ① | M02 架構計画 | M03 クレーン仕様 | 柱芯間距離⇔クレーンスパン |\n| ② | M05 建物高さ | M03 クレーン仕様 | 揚程⇔軒高 |\n| ... | ... | ... | ... |\n```\n\n---\n\n## 7. 変換手順\n\n### Step 1: ゴールを定義\nG1〜G6を定義し、展開順序を確認。\n\n### Step 2: 最初のゴール（G3）を展開\n問い1を適用：「鉄骨を発注するには何が決まっている必要があるか？」\n→ 直接必要な決定を Level 1 ノードとして抽出\n\n### Step 3: 各ノードに問い2を再帰適用（深さ制限内で）\n- Level 1 → Level 2 → Level 3（根）の順に展開\n- **Level 3で根に到達しない場合は粒度統合で調整**\n- 各ノードにノード化条件（4-1）を適用、不適合はメタデータ化\n\n### Step 4: Part A〜Dを生成\n- Step 2-3で得たノードとエッジを4パート形式で出力\n- 間引きルール（5-3）を適用\n- 推移的省略を確認\n\n### Step 5: 次のゴールを展開（重複排除）\nG2以降を展開。既出ノードは参照エッジのみ追加。\n\n### Step 6: 相互依存を付加\n双方向制約をPart Dに追加。\n\n### Step 7: 品質チェック\n→ セクション9のチェックリストを実行\n\n---\n\n## 8. メタデータの扱い\n\nノードにしないがPart Aテーブルの「メタデータ」列に格納する情報：\n\n| 項目 | 例 |\n|------|----|\n| 選択肢 | S造/RC造/SRC造 |\n| 判断基準 | スパン、工期、コスト、耐火要件 |\n| 確定方法 | ボーリング調査、行政確認 |\n| 自動導出値 | 積雪荷重（地域条件から自動） |\n| PM/CM管理行動 | 別表で管理（Part A外） |\n\n---\n\n## 9. 品質チェックリスト\n\n### ゴール到達性\n- [ ] 全ノードが少なくとも1つのゴールへの到達パス上にある\n- [ ] 全ゴールから根まで途切れなく遡れる\n- [ ] 孤立ノードがない\n\n### ノードの品質\n- [ ] 全ノードが「〜を決める」に言い換え可能\n- [ ] 説明文・手段・選択肢がノードに混入していない\n- [ ] 自動導出値がノードになっていない\n- [ ] ノードラベルが15文字以内\n\n### エッジの品質\n- [ ] 全エッジの方向が「先決 → 後続」\n- [ ] 推移的依存（A→B→CのときA→C）が残っていない（例外除く）\n- [ ] 相互依存がPart Dに記載されている\n\n### 構造の品質\n- [ ] 根（R*）はエッジの始点のみ\n- [ ] ゴール（G*）はエッジの終点のみ（G間依存除く）\n- [ ] 最大深さがLevel 3以内（例外はLevel 4まで）\n- [ ] 複数ゴールの共有ノードが参照表現されている\n\n### テキスト出力の品質（v3.0新規）\n- [ ] Part A〜D間で情報が重複していない\n- [ ] Part Aに全ノードが漏れなく記載されている\n- [ ] Part Bに全エッジが漏れなく記載されている\n- [ ] Part Cのツリー図が左→右（根→ゴール）の流れ\n- [ ] Part Cで表現しきれないエッジがPart Bで補完されている\n- [ ] 相互依存がPart Cに混入していない（Part Dのみ）\n\n---\n\n## 10. v2.0からの主要変更点\n\n| 項目 | v2.0 | v3.0 | 変更理由 |\n|------|------|------|---------|\n| 出力形式 | 視覚マインドマップ前提 | テキスト（Markdown）前提 | テキスト出力で破綻しないため |\n| 深さ制限 | なし（無制限再帰） | 最大Level 3（例外Level 4） | 出力の可読性確保 |\n| 出力構成 | 1つのツリー図に全情報 | 4パート分離（A〜D） | 情報種別ごとに最適な表現 |\n| 相互依存 | ツリー内に双方向矢印 | 別テーブル（Part D） | テキストツリーで双方向は破綻 |\n| メタデータ | ノードのメモ/注釈 | Part Aテーブルの列 | テキストで一覧管理 |\n| 色分け | 視覚色（赤/青/緑等） | 担当列のテキストラベル | テキスト環境では色が使えない |\n| ノード記法 | `[ID] ノード名` をツリー内に | ツリーは`[ID]`のみ、名称はPart A | ツリー図の幅を抑制 |",
    "ノードのラベルは『[ID] 名称』という形式（例：[A1] 柱スパン決定）で統一し、IDを冒頭に付与する。",
    "IDのアルファベットの先頭文字を、特定のカテゴリ（A: 建築、B: 構造、C: 設備、E: 外構、F/G: 調達・工程）と対応させる。",
    "ルートノードからは、プロジェクトの最終成果物や重要な節目となる「Gシリーズ（マイルストーン）」へ直接エッジを接続する。",
    "カテゴリ名は「〇〇計画」「〇〇管理」など、専門的な業務区分に基づいた日本語で統一する。",
    "依存関係（エッジ）は、『設計要素（A-E）』→『調整・承認プロセス（F）』→『最終決定・着工（G）』という論理的な工程フローに基づいて設定する。",
    "ラベルには「ファブグレード」「設計GL」「工作図」などの建設業界の専門用語を正確に使用する。",
    "複数の前提条件（source）が揃って初めて次の工程（target）に進める場合、それら全ての依存関係を網羅的に接続する（例：B3とC3の両方がF5の前提となる構造）。"
  ]
}